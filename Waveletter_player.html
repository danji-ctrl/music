<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spin Wheel - Quay may m·∫Øn</title>
  <style>
    :root{--accent:#ffcc00;--bg:#0f1724;--card:#0b1220}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071025 0%, #0b1220 60%);color:#e6eef8;font-family:Inter,system-ui,Arial;display:flex;align-items:center;justify-content:center;padding:24px}

    .wrap{width:100%;max-width:980px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:16px;padding:24px;display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:center;box-shadow:0 10px 30px rgba(2,6,23,0.6)}

    /* Left: Wheel */
    .wheel-area{display:flex;flex-direction:column;align-items:center;gap:18px}
    .wheel-box{width:420px;height:420px;display:grid;place-items:center;position:relative}
    .wheel{width:360px;height:360px;border-radius:50%;position:relative;transition:transform 4s cubic-bezier(.12,.9,.24,.99);box-shadow:0 12px 30px rgba(2,6,23,0.6), inset 0 2px 8px rgba(255,255,255,0.02)}
    .wheel .segment{position:absolute;left:50%;top:50%;transform-origin:0 0;width:50%;height:50%;overflow:visible}
    .wheel .segment .label{position:absolute;left:50%;top:50%;transform:translate(-50%,-40%) rotate(0deg);width:40%;text-align:center;font-weight:600;font-size:14px}

    /* pointer */
    .pointer{position:absolute;top:-6px;left:50%;transform:translateX(-50%);z-index:3}
    .pointer .arrow{width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--accent);filter:drop-shadow(0 6px 10px rgba(0,0,0,0.6))}

    /* Right: Controls */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:18px;border-radius:12px;height:100%;display:flex;flex-direction:column;gap:12px}
    .panel h2{margin:0;font-size:18px}
    .turns{font-size:16px;padding:10px 12px;background:rgba(255,255,255,0.02);border-radius:8px}
    .btn{display:inline-block;padding:12px 18px;border-radius:10px;font-weight:700;border:none;cursor:pointer}
    .spin-btn{background:linear-gradient(90deg,#ff7a00,#ffcc00);color:#08121b;font-size:18px;box-shadow:0 8px 24px rgba(255,136,0,0.18)}
    .spin-btn[disabled]{opacity:0.5;cursor:not-allowed}
    .sm{font-size:13px;color:#a9bdcf}

    /* Popup */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,8,18,0.6);backdrop-filter:blur(4px);z-index:40}
    .overlay.show{display:flex}
    .popup{width:92%;max-width:560px;background:linear-gradient(180deg,#071426 0%, #071426 70%);border-radius:14px;padding:26px;text-align:center;position:relative;box-shadow:0 20px 60px rgba(2,6,23,0.7);overflow:hidden}

    /* light effect */
    .popup::before{content:"";position:absolute;inset:-40%;background:radial-gradient(circle at 20% 10%, rgba(255,220,80,0.22), transparent 12%), radial-gradient(circle at 80% 80%, rgba(255,80,120,0.12), transparent 10%);animation:glow 3s ease-in-out infinite}
    @keyframes glow{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}

    .prize-card{position:relative;z-index:2;padding:18px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(0,0,0,0.5)}
    .prize-emoji{font-size:64px;margin-bottom:6px}
    .prize-title{font-size:20px;font-weight:800;margin:0}
    .prize-desc{color:#9fb3c9;margin-top:6px}

    .continue-btn{margin-top:18px;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,#00d4ff,#0066ff);color:#fff;font-weight:700;border:none;cursor:pointer}

    /* small responsive */
    @media (max-width:900px){.wrap{grid-template-columns:1fr;}
      .wheel-box{width:320px;height:320px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="wheel-area">
      <div class="wheel-box">
        <div class="pointer" aria-hidden><div class="arrow"></div></div>
        <div id="wheel" class="wheel" role="img" aria-label="V√≤ng quay may m·∫Øn"></div>
      </div>
      <div style="display:flex;gap:12px;align-items:center">
        <button id="spinBtn" class="btn spin-btn">SPIN</button>
        <div class="sm">K·∫øt qu·∫£: <strong id="resultLabel">‚Äî</strong></div>
      </div>
    </div>

    <div class="panel">
      <h2>Quay may m·∫Øn</h2>
      <div class="turns">L∆∞·ª£t c√≤n l·∫°i: <strong id="turnsLeft">3</strong></div>
      <div class="sm">M·ªói l∆∞·ª£t ch·ªâ quay 1 l·∫ßn. Ch√∫c b·∫°n may m·∫Øn!</div>

      <div style="margin-top:auto">
        <button id="resetBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dbeeff">Reset l∆∞·ª£t</button>
      </div>
    </div>
  </div>

  <!-- Popup -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="popup">
      <div class="prize-card">
        <div class="prize-emoji" id="prizeEmoji">üéâ</div>
        <h3 class="prize-title" id="prizeTitle">B·∫°n ƒë√£ th·∫Øng!</h3>
        <p class="prize-desc" id="prizeDesc">M√¥ t·∫£ ph·∫ßn th∆∞·ªüng</p>
        <button id="continueBtn" class="continue-btn">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>

  <script>
    // C·∫•u h√¨nh ph·∫ßn th∆∞·ªüng
    const prizes = [
      {label: '50k VNƒê', emoji: 'üíµ', desc: 'M√£ gi·∫£m gi√° 50,000ƒë'},
      {label: 'Th∆∞·ªüng 100k', emoji: 'üèÜ', desc: 'Ti·ªÅn th∆∞·ªüng 100,000ƒë'},
      {label: 'Voucher 30%', emoji: 'üéüÔ∏è', desc: 'Voucher gi·∫£m 30%'},
      {label: 'Qu√† l∆∞u ni·ªám', emoji: 'üéÅ', desc: 'Qu√† t·∫∑ng ƒë·ªôc quy·ªÅn'},
      {label: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn', emoji: 'üöö', desc: 'Mi·ªÖn ph√≠ ship 1 ƒë∆°n'},
      {label: 'C·∫£m ∆°n ƒë√£ tham gia', emoji: 'üëè', desc: 'Kh√¥ng c√≥ ph·∫ßn th∆∞·ªüng'}
    ];

    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const resultLabel = document.getElementById('resultLabel');
    const turnsLeftEl = document.getElementById('turnsLeft');
    const overlay = document.getElementById('overlay');
    const prizeEmoji = document.getElementById('prizeEmoji');
    const prizeTitle = document.getElementById('prizeTitle');
    const prizeDesc = document.getElementById('prizeDesc');
    const continueBtn = document.getElementById('continueBtn');
    const resetBtn = document.getElementById('resetBtn');

    let turnsLeft = 3; // s·ªë l∆∞·ª£t m·∫∑c ƒë·ªãnh
    let spinning = false;
    let currentRotation = 0;

    function renderWheel(){
      wheel.innerHTML = '';
      const len = prizes.length;
      const angle = 360 / len;
      for(let i=0;i<len;i++){
        const seg = document.createElement('div');
        seg.className = 'segment';
        const rot = i * angle;
        seg.style.transform = `rotate(${rot}deg) translate(-100%, -100%)`;

        const segInner = document.createElement('div');
        segInner.style.transform = `rotate(${angle/2}deg)`;
        segInner.innerHTML = `<div class="label">${prizes[i].label}</div>`;
        seg.appendChild(segInner);

        // alternating colors
        seg.style.background = i%2===0 ? 'conic-gradient(from 0deg, rgba(255,255,255,0.03), transparent)' : 'conic-gradient(from 0deg, rgba(255,255,255,0.01), transparent)';
        wheel.appendChild(seg);
      }
      // draw center circle
      const center = document.createElement('div');
      center.style.width = '36%';center.style.height='36%';center.style.borderRadius='50%';center.style.position='absolute';center.style.left='50%';center.style.top='50%';center.style.transform='translate(-50%,-50%)';center.style.background='linear-gradient(180deg,#081827,#0b2130)';center.style.display='grid';center.style.placeItems='center';center.style.zIndex='2';
      center.innerHTML = `<div style="font-weight:800;font-size:18px;letter-spacing:1px;color:var(--accent)">QUAY</div>`;
      wheel.appendChild(center);
    }

    function spinOnce(){
      if(spinning) return;
      if(turnsLeft<=0){alert('B·∫°n ƒë√£ h·∫øt l∆∞·ª£t quay.');return}
      spinning=true;
      spinBtn.disabled=true;

      // ch·ªçn k·∫øt qu·∫£ ng·∫´u nhi√™n (c√≥ th·ªÉ thay b·∫±ng logic t·ªâ l·ªá)
      const winnerIndex = Math.floor(Math.random()*prizes.length);
      const len = prizes.length;
      const anglePer = 360/len;

      // t√≠nh g√≥c ƒë·ªÉ d·ª´ng: ch√∫ng ta mu·ªën ƒë∆∞a mid c·ªßa segment v·ªÅ pointer (0deg)
      const randomRound = Math.floor(Math.random()*3)+3; // 3..5 v√≤ng
      const targetAngle = 360 - (winnerIndex * anglePer + anglePer/2);
      const finalRotation = randomRound*360 + targetAngle;

      currentRotation = (currentRotation + finalRotation) % 360;
      wheel.style.transition = 'transform 4s cubic-bezier(.12,.9,.24,.99)';
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      // khi animation k·∫øt th√∫c
      wheel.addEventListener('transitionend', function handler(){
        wheel.removeEventListener('transitionend', handler);
        spinning=false;
        turnsLeft--;
        updateUI();
        showPrize(winnerIndex);
      });
    }

    function updateUI(){
      turnsLeftEl.textContent = turnsLeft;
      if(turnsLeft<=0) spinBtn.disabled=true;
    }

    function showPrize(index){
      const p = prizes[index];
      prizeEmoji.textContent = p.emoji;
      prizeTitle.textContent = p.label;
      prizeDesc.textContent = p.desc;
      resultLabel.textContent = p.label;

      // th√™m hi·ªáu ·ª©ng: animation nh·ªè cho emoji
      prizeEmoji.animate([
        { transform: 'scale(0.6) rotate(-10deg)', opacity:0.6 },
        { transform: 'scale(1.12) rotate(6deg)', opacity:1 },
        { transform: 'scale(1) rotate(0)' }
      ],{ duration:650, easing:'cubic-bezier(.17,.67,.33,1)' });

      overlay.classList.add('show');

      // optional: highlight winning segment briefly
      flashWinningSegment(index);
    }

    function flashWinningSegment(index){
      // simple glow on wheel center while popup
      const highlight = document.createElement('div');
      highlight.style.position='absolute';highlight.style.inset='0';highlight.style.borderRadius='50%';highlight.style.boxShadow='0 0 60px 18px rgba(255,204,0,0.12)';highlight.style.pointerEvents='none';highlight.style.zIndex='1';
      wheel.appendChild(highlight);
      setTimeout(()=>{highlight.remove();},2000);
    }

    continueBtn.addEventListener('click', ()=>{
      overlay.classList.remove('show');
      if(turnsLeft<=0){spinBtn.disabled=true;} else {spinBtn.disabled=false}
    });

    spinBtn.addEventListener('click', ()=>spinOnce());
    resetBtn.addEventListener('click', ()=>{turnsLeft=3;updateUI();spinBtn.disabled=false;resultLabel.textContent='‚Äî'});

    // init
    renderWheel();
    updateUI();

    // accessibility: space/enter to spin
    document.addEventListener('keydown', (e)=>{
      if((e.code==='Space' || e.key==='Enter') && !spinning){
        spinOnce();
      }
    });
  </script>
</body>
</html>
